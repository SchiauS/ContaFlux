<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ContaFlux - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">ContaFlux</a>
    <span class="navbar-text">Analiză contabilă + Asistent AI</span>
  </div>
</nav>
<div class="container">
  <div class="row g-3 mb-3">
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted text-uppercase">Venituri luna curentă</h6>
          <h3 class="fw-bold" id="kpi-revenue">-</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted text-uppercase">Cheltuieli</h6>
          <h3 class="fw-bold" id="kpi-expenses">-</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted text-uppercase">Marjă</h6>
          <h3 class="fw-bold" id="kpi-margin">-</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted text-uppercase">Cashflow</h6>
          <h3 class="fw-bold" id="kpi-cashflow">-</h3>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-lg-8">
      <div class="card shadow-sm mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>Chat AI financiar</span>
          <div>
            <span class="badge bg-secondary" id="session-label">Session: local</span>
          </div>
        </div>
        <div class="card-body" style="height: 380px; overflow-y: auto;" id="chat-window">
          <div class="text-muted">Scrie o întrebare pentru a începe dialogul cu asistentul.</div>
        </div>
        <div class="card-footer">
          <form id="chat-form" class="d-flex gap-2">
            <input type="text" class="form-control" id="chat-input" placeholder="Întrebare despre rezultate, cashflow, bugete ..." required>
            <button class="btn btn-primary" type="submit">Trimite</button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header">Rezumat AI</div>
        <div class="card-body">
          <button class="btn btn-outline-primary w-100 mb-2" id="btn-refresh-summary">Generează rezumat lunar</button>
          <div id="summary-content" class="small text-muted">Niciun rezumat încă.</div>
        </div>
      </div>
      <div class="card shadow-sm">
        <div class="card-header">Sarcini / Checklist</div>
        <div class="card-body">
          <ul class="list-group" id="task-list">
            <li class="list-group-item">Închidere lunară - pregătire balanță</li>
            <li class="list-group-item">Verificare facturi furnizori</li>
            <li class="list-group-item">Actualizare cashflow forecast</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const API_BASE = 'http://localhost:8000/api'; // ajustează după configurarea backendului

  function appendMessage(sender, text) {
    const bubbleClass = sender === 'ai' ? 'bg-light' : 'bg-primary text-white';
    const align = sender === 'ai' ? 'start' : 'end';
    const bubble = `<div class="d-flex flex-column align-items-${align} mb-2">
      <div class="rounded p-2 ${bubbleClass}" style="max-width: 90%; white-space: pre-wrap;">${text}</div>
    </div>`;
    $('#chat-window').append(bubble);
    $('#chat-window').scrollTop($('#chat-window')[0].scrollHeight);
  }

  $('#chat-form').on('submit', function (e) {
    e.preventDefault();
    const message = $('#chat-input').val();
    appendMessage('user', message);
    $('#chat-input').val('');

    $.post({
      url: `${API_BASE}/ai/chat`,
      data: { message },
      success: function (data) {
        appendMessage('ai', data.message || '[Răspuns indisponibil]');
      },
      error: function () {
        appendMessage('ai', 'Nu am putut contacta backend-ul. Verifică serverul.');
      }
    });
  });

  $('#btn-refresh-summary').on('click', function () {
    $('#summary-content').text('Se generează rezumat...');
    $.get({
      url: `${API_BASE}/ai/summary`,
      data: { period: 'month' },
      success: function (data) {
        $('#summary-content').text(data.summary || 'Fără conținut.');
      },
      error: function () {
        $('#summary-content').text('Nu am putut genera rezumatul.');
      }
    });
  });
</script>
</body>
</html>
